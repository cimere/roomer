use roomer
db.users.insert({"_id": "cmeregalli", "name": "Ciro", "surname": "Meregalli", "email": "ciro.meregalli@fastweb.it"});
db.users.insert({"_id": "mredaelli", "name": "Marco", "surname": "Redaelli", "email": "marco.redaelli@fastweb.it"});
db.users.insert({"_id": "ascatton", "name": "Alessandro", "surname": "Scatton", "email": "alessandro.scatton@fastweb.it"});
// rooms
db.rooms.insert({"name": "Turing", "reservations": []});
db.rooms.insert({"name": "Hopper", "reservations": []});
db.rooms.insert({"name": "Ritchie", "reservations": []});
// add some reservations...
db.rooms.update({"name": "Turing"}, {$push: {"reservations": {user: "cmeregalli",
							      start:ISODate("2012-12-19T08:00:00.000Z"),
							      end:ISODate("2012-12-19T09:00:00.000Z")}}});
db.rooms.update({"name": "Turing"}, {$push: {"reservations": {user: "mredaelli",
							      start:ISODate("2012-12-19T09:00:00.000Z"),
							      end:ISODate("2012-12-19T11:00:00.000Z")}}});
db.rooms.update({"name": "Turing"}, {$push: {"reservations": {user: "cmeregalli",
							      start:ISODate("2012-12-19T08:00:00.000Z"),
							      end:ISODate("2012-12-19T09:00:00.000Z")}}});
db.rooms.update({"name": "Ritchie"}, {$push: {"reservations": {user: "cmeregalli",
							       start:ISODate("2012-12-19T08:00:00.000Z"),
							       end:ISODate("2012-12-19T09:00:00.000Z")}}});
// add index on reservations
db.rooms.ensureindex({"reservations": 1});

// query: rooms reserverd by user (back traversal)
db.rooms.aggregate([{ $unwind : '$reservations' }, { $match : { 'reservations.user': 'cmeregalli'  }}]);
